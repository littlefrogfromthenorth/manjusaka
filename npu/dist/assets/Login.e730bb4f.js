var z=Object.defineProperty;var C=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var L=(e,s,o)=>s in e?z(e,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[s]=o,S=(e,s)=>{for(var o in s||(s={}))E.call(s,o)&&L(e,o,s[o]);if(C)for(var o of C(s))G.call(s,o)&&L(e,o,s[o]);return e};var _=(e,s,o)=>new Promise((l,m)=>{var p=c=>{try{f(o.next(c))}catch(a){m(a)}},i=c=>{try{f(o.throw(c))}catch(a){m(a)}},f=c=>c.done?l(c.value):Promise.resolve(c.value).then(p,i);f((o=o.apply(e,s)).next())});import{r as I,c as g,u as b,a as t,b as D,I as B,e as V,f as $,w as j,v as U,o as F,i as k,j as y,k as u,l as d,B as q,m as K,t as Q,n as W,p as H,q as J,s as X,x as Y,y as Z,z as ee,A as se,C as O,D as oe,E as te,F as A}from"./index.59109d81.js";import{F as N}from"./index.24c08581.js";import"./index.9a88e72b.js";import"./_baseIteratee.2ac5361a.js";import"./isEqual.442fc559.js";import"./useSize.f495344d.js";var ae="./assets/logo.5763185f.png",M=(e=>(e[e.LOGIN=0]="LOGIN",e[e.REGISTER=1]="REGISTER",e[e.RESET_PASSWORD=2]="RESET_PASSWORD",e[e.MOBILE=3]="MOBILE",e[e.QR_CODE=4]="QR_CODE",e))(M||{});const T=I(0);function le(){function e(l){T.value=l}const s=g(()=>T.value);function o(){e(0)}return{setLoginState:e,getLoginState:s,handleBackLogin:o}}function re(e){function s(){return _(this,null,function*(){const o=t(e);return o?yield o.validate():void 0})}return{validForm:s}}function ne(e){const{t:s}=b(),o=g(()=>R(s("sys.login.accountPlaceholder"))),l=g(()=>R(s("sys.login.passwordPlaceholder"))),m=g(()=>R(s("sys.login.smsPlaceholder"))),p=g(()=>R(s("sys.login.mobilePlaceholder"))),i=(a,r)=>_(this,null,function*(){return r?Promise.resolve():Promise.reject(s("sys.login.policyPlaceholder"))}),f=a=>(r,h)=>_(this,null,function*(){return h?h!==a?Promise.reject(s("sys.login.diffPwd")):Promise.resolve():Promise.reject(s("sys.login.passwordPlaceholder"))});return{getFormRules:g(()=>{const a=t(o),r=t(l),h=t(m),P=t(p),x={sms:h,mobile:P};switch(t(T)){case 1:return S({account:a,password:r,confirmPassword:[{validator:f(e==null?void 0:e.password),trigger:"change"}],policy:[{validator:i,trigger:"change"}]},x);case 2:return S({account:a},x);case 3:return x;default:return{account:a,password:r}}})}}function R(e){return[{required:!0,message:e,trigger:"change"}]}const ce={class:"mt-2 flex flex-grow-0"},ie=D({__name:"LoginForm",setup(e){const s=N.Item,o=B.Password,{t:l}=b(),{notification:m}=J(),p=V(),{getLoginState:i}=le(),{getFormRules:f}=ne(),c=I(),a=I(!1),r=$({account:"",password:"",captcha:""}),{validForm:h}=re(c),P=g(()=>t(i)===M.LOGIN);function x(){return _(this,null,function*(){const w=yield h();if(!!w)try{a.value=!0;const n=yield p.login("login",{captcha:w.captcha,username:w.account,password:H(w.password)});n&&m.success({message:l("sys.login.loginSuccessTitle"),description:`${l("sys.login.loginSuccessDesc")}: ${n.username}`,duration:3})}catch(n){document.getElementById("captchaimgaddr").src="../captcha?t="+Math.random()}finally{a.value=!1}})}return(w,n)=>j((F(),k(t(N),{class:"p-4 enter-x",model:r,rules:t(f),ref_key:"formRef",ref:c,onKeypress:W(x,["enter"])},{default:y(()=>[u(t(s),{name:"account",class:"enter-x"},{default:y(()=>[u(t(B),{size:"large",value:r.account,"onUpdate:value":n[0]||(n[0]=v=>r.account=v),placeholder:t(l)("sys.login.userName"),class:"fix-auto-fill"},null,8,["value","placeholder"])]),_:1}),u(t(s),{name:"password",class:"enter-x"},{default:y(()=>[u(t(o),{size:"large",visibilityToggle:"",value:r.password,"onUpdate:value":n[1]||(n[1]=v=>r.password=v),placeholder:t(l)("sys.login.password")},null,8,["value","placeholder"])]),_:1}),u(t(s),{name:"captcha",class:"enter-x"},{default:y(()=>[d("div",ce,[u(t(B),{size:"large",visibilityToggle:"",value:r.captcha,"onUpdate:value":n[2]||(n[2]=v=>r.captcha=v),placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"},null,8,["value"]),n[3]||(n[3]=d("img",{id:"captchaimgaddr",src:"../captcha",onclick:"this.src='../captcha?t='+Math.random();"},null,-1))])]),_:1}),u(t(s),{class:"enter-x"},{default:y(()=>[u(t(q),{type:"primary",size:"large",block:"",onClick:x,loading:a.value},{default:y(()=>[K(Q(t(l)("sys.login.loginButton")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])),[[U,P.value]])}});const ue={class:"-enter-x xl:hidden"},de={class:"container relative h-full py-2 mx-auto sm:px-10"},pe={class:"flex h-full"},me={class:"flex w-full h-full py-5 xl:h-auto xl:py-0 xl:my-0 xl:w-6/12"},_e=D({__name:"Login",props:{sessionTimeout:{type:Boolean}},setup(e){const s=X(),{prefixCls:o}=Y("login");b();const m=Z().getShowPicker;return g(()=>{var p;return(p=s==null?void 0:s.title)!=null?p:""}),(p,i)=>(F(),ee("div",{class:A([t(o),"relative w-full h-full px-4"])},[!e.sessionTimeout&&t(m)?(F(),k(t(se),{key:0,class:"absolute text-white top-4 right-4 enter-x xl:text-gray-600",showText:!1})):O("",!0),e.sessionTimeout?O("",!0):(F(),k(t(oe),{key:1,class:"absolute top-3 right-7 enter-x"})),d("span",ue,[u(t(te),{alwaysShowTitle:!0})]),d("div",de,[d("div",pe,[i[1]||(i[1]=d("div",{class:"hidden min-h-full pl-4 mr-4 xl:flex xl:flex-col xl:w-6/12"},[d("div",{class:"my-auto"})],-1)),d("div",me,[d("div",{class:A([`${t(o)}-form`,"relative w-full px-5 py-8 mx-auto my-auto rounded-md shadow-md xl:ml-16 xl:bg-transparent sm:px-8 xl:p-4 xl:shadow-none sm:w-3/4 lg:w-2/4 xl:w-auto enter-x"])},[i[0]||(i[0]=d("img",{src:ae},null,-1)),u(ie)],2)])])])],2))}});export{_e as default};
