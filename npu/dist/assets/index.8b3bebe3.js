var V=Object.defineProperty,q=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var I=(e,o,t)=>o in e?V(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,R=(e,o)=>{for(var t in o||(o={}))U.call(o,t)&&I(e,t,o[t]);if(v)for(var t of v(o))j.call(o,t)&&I(e,t,o[t]);return e},k=(e,o)=>q(e,O(o));var C=(e,o,t)=>new Promise((l,s)=>{var u=a=>{try{n(t.next(a))}catch(i){s(i)}},r=a=>{try{n(t.throw(a))}catch(i){s(i)}},n=a=>a.done?l(a.value):Promise.resolve(a.value).then(u,r);n((t=t.apply(e,o)).next())});import{I as N,B as G,u as L}from"./useTable.8f642a92.js";import{B as Q,u as W,o as F,p as H,T as J}from"./useForm.a5b01752.js";import{b as E,r as b,e as K,c as X,a as T,bM as p,I as Y,aQ as $,p as y,cj as h,aR as d,o as S,i as Z,j as B,k as f,aT as ee,q as A,z as te,m as ae,ck as oe}from"./index.59109d81.js";import{B as ne,u as se,a as ue}from"./index.abeaa45a.js";import"./index.9a88e72b.js";import"./index.7d1af758.js";import"./index.169a2f8c.js";import"./index.6af6e8ee.js";import"./useSize.f495344d.js";import"./useContentViewHeight.b742a811.js";import"./ArrowLeftOutlined.76351c5d.js";import"./index.5d8d8edd.js";import"./FullscreenOutlined.e9ba2b3a.js";import"./_baseIteratee.2ac5361a.js";import"./index.b51e258d.js";import"./index.3b17542c.js";import"./isEqual.442fc559.js";import"./index.ef80d76f.js";import"./useSortable.98c26055.js";import"./index.24c08581.js";import"./scrollTo.66a1ba12.js";import"./index.f2a8f060.js";import"./download.60714c4e.js";const re=E({name:"RoleModal",components:{BasicModal:ne,BasicForm:Q},emits:["success","register"],setup(e,{emit:o}){var _;const t=b(!1),{createMessage:l}=A(),s=K(),u=X(()=>s.getUserInfo||{}),r=b(""),n=b("../captcha"),a=()=>{n.value=`../captcha?t=${new Date().getTime()}`},[i,{setFieldsValue:m,updateSchema:de,resetFields:w,validate:D,getFieldsValue:me}]=W({labelWidth:60,schemas:[{field:"username",label:"\u7528\u6237\u540D",component:"Input",defaultValue:((_=T(u))==null?void 0:_.username)||"",componentProps:{disabled:!0}},{field:"password",label:"\u65E7\u5BC6\u7801",required:!0,component:"InputPassword",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u5F53\u524D\u5BC6\u7801"}},{field:"newpass",label:"\u65B0\u5BC6\u7801",required:!0,component:"InputPassword",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801"}},{field:"captcha",label:"\u9A8C\u8BC1\u7801",component:"Input",required:!0,renderColContent:({model:g})=>p(H,{gutter:10},[p(F,{span:3,style:{textAlign:"right"}},"\u9A8C\u8BC1\u7801"),p(F,{span:16},[p(Y,{placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",onChange:c=>{r.value=c.target.value}})]),p(F,{span:5},[p(N,{src:n.value,alt:"\u9A8C\u8BC1\u7801\uFF0C\u70B9\u51FB\u5237\u65B0",width:"100%",height:"32px",onClick:a,preview:!1})])])}],showActionButtonGroup:!1,actionColOptions:{span:23}}),[P,{closeModal:x}]=se(g=>C(this,null,function*(){var c;w(),m({username:((c=T(u))==null?void 0:c.username)||""})}));function z(){return C(this,null,function*(){t.value=!0;const g=yield D(),c=k(R({},g),{password:y(g.password),newpass:y(g.newpass),captcha:r.value});h({action:"password",data:c}).then(M=>{M==="ok"?(l.success("\u5BC6\u7801\u4FEE\u6539\u6210\u529F"),w(),x(),s.logout(!0)):l.error(`${M}`)}).catch(()=>{}).finally(()=>{t.value=!1,a()})})}return{registerModal:P,registerForm:i,userinfo:u,confirmLoading:t,handleSubmit:z}}});function ie(e,o,t,l,s,u){const r=d("BasicForm"),n=d("BasicModal");return S(),Z(n,ee(e.$attrs,{title:"\u4FEE\u6539\u5BC6\u7801",onRegister:e.registerModal,onOk:e.handleSubmit}),{default:B(()=>[f(r,{onRegister:e.registerForm},null,8,["onRegister"])]),_:1},16,["onRegister","onOk"])}var le=$(re,[["render",ie]]);const ce=E({name:"RoleManagement",components:{BasicTable:G,TableAction:J,RoleModal:le},setup(){const{createMessage:e}=A(),[o,{openModal:t}]=ue(),[l,{reload:s}]=L({title:"\u5168\u5C40\u8BBE\u7F6E\u9009\u9879",columns:[{title:"\u952E",dataIndex:"key",align:"right"},{title:"\u503C",dataIndex:"value",align:"left",edit:!0},{title:"\u5907\u6CE8",width:250,dataIndex:"keynote"},{title:"\u65F6\u95F4",width:200,dataIndex:"updateat",customRender:({record:a})=>oe(new Date(a.updateat*1e3))}],showTableSetting:!0,bordered:!0,showIndexColumn:!1,size:"small",beforeEditSubmit:u,clickToRowSelect:!1,api:h,pagination:{pageSizeOptions:[100,200,500,1e3],pageSize:100},actionColumn:{width:150,title:"\u64CD\u4F5C",dataIndex:"action",slots:{customRender:"action"},fixed:void 0},beforeFetch:function(a){const{page:i,pageSize:m}=a;return{action:"settinglist",pagenum:i,pagesize:m}}});function u(a){console.log(a),h({action:"settingupdate",data:{key:a.record.key,value:a.value}}).then(()=>{e.success("\u66F4\u65B0\u6210\u529F")}).catch(()=>{}).finally(()=>{s()})}function r(a){h({action:"settingdelete",data:{id:a.key}}).then(()=>{e.success("\u5220\u9664\u6210\u529F")}).catch(()=>{}).finally(()=>{s()})}function n(){t(!0,{})}return{registerTablesets:l,registerModal:o,handleEdit:u,handleDelete:r,ChangePwd:n}}});function pe(e,o,t,l,s,u){const r=d("a-button"),n=d("TableAction"),a=d("BasicTable"),i=d("RoleModal");return S(),te("div",null,[f(a,{onRegister:e.registerTablesets},{toolbar:B(()=>[f(r,{type:"primary",onClick:e.ChangePwd},{default:B(()=>[...o[0]||(o[0]=[ae(" \u4FEE\u6539\u5BC6\u7801 ",-1)])]),_:1},8,["onClick"])]),action:B(({record:m})=>[f(n,{actions:[{icon:"ant-design:delete-outlined",color:"error",label:"\u5220\u9664",popConfirm:{title:"\u786E\u8BA4\u5220\u9664?",confirm:e.handleDelete.bind(null,m)}}]},null,8,["actions"])]),_:1},8,["onRegister"]),f(i,{onRegister:e.registerModal},null,8,["onRegister"])])}var Ve=$(ce,[["render",pe]]);export{Ve as default};
