import{aQ as C,b as _,d_ as D,aP as f,dM as v,f as E,c as I,s as F,e8 as R,bu as $,b0 as y,aa as P,am as S,ea as M,a2 as W,aR as l,o as j,i as U,j as g,k as h,q as N,cj as b,bM as B,e7 as z}from"./index.ecaec58b.js";import{B as G}from"./index.4cf09d76.js";import{B as H,u as q}from"./useTable.64ef5827.js";import{T as L,j as O}from"./useForm.77c27927.js";import{T as w}from"./index.502108af.js";import{a as Q}from"./index.7c437fb2.js";import{n as V}from"./nps.6de071b3.js";import"./index.e03c8569.js";import"./ArrowLeftOutlined.68372d7a.js";import"./isEqual.07d69833.js";import"./_baseIteratee.95e39a32.js";import"./index.d2065cf3.js";import"./FullscreenOutlined.fdf277a8.js";import"./index.84bf6fd3.js";import"./index.c74c0e50.js";import"./useContentViewHeight.33e9d1e7.js";import"./index.e472a703.js";import"./index.42eff1d5.js";import"./useSortable.d7a4a5d8.js";import"./index.5adf4b72.js";import"./index.66a07c9f.js";import"./useSize.37dbc3ba.js";import"./scrollTo.3f609abf.js";import"./index.9c3be20b.js";import"./index.09531035.js";import"./download.0a6ebd5a.js";import"./index.81d2e3e6.js";const J=_({name:"AgentList",components:{BasicTable:H,TableAction:L,Time:w,Modal:D,BasicDrawer:G,Icon:f,PageWrapper:Q,PopConfirmButton:v},setup(){const a=E({uid:O(),agents:{}}),s=I(()=>{const e=[];return Object.keys(a.agents).forEach(t=>{e.push(a.agents[t])}),e}),{apiUrl:c="/manjusaka"}=F(),d=(window.location.protocol==="https:"?"wss:":"ws:")+"//"+window.location.host+c+"/webproxy/log/"+a.uid,{data:r,send:A,close:p}=R(d,{autoReconnect:!1,heartbeat:!1}),u=$();y();const{createMessage:o}=N(),[i,{reload:X}]=q({columns:[{width:0,dataIndex:"id"},{title:"\u5B58\u6D3B",align:"left",width:120,dataIndex:"updateat",customRender:({record:e})=>B(w,{step:1,value:z(e.updateat*1e3)})},{title:"\u7CFB\u7EDF\u7C7B\u578B",align:"left",dataIndex:"platform",customRender:({record:e})=>[B(f,{size:20,icon:e.platform=="windows"?"devicon:windows8":"devicon:linux"}),"   "+e.platform+"."+e.arch]},{title:"\u5185\u7F51\u5730\u5740",align:"left",dataIndex:"intranet"},{title:"\u7528\u6237\u540D",align:"left",dataIndex:"username"},{title:"\u4E3B\u673A\u540D",align:"left",dataIndex:"hostname"},{title:"\u8FDB\u7A0B\u540D\u79F0",align:"left",dataIndex:"process",customRender:({record:e})=>e.process?e.process.replaceAll("\\","/").split("/").pop():e.process},{title:"\u5907\u6CE8",dataIndex:"note",edit:!0}],clickToRowSelect:!0,bordered:!0,striped:!0,showIndexColumn:!0,pagination:!1,tableSetting:{size:!0,setting:!0},size:"small",beforeEditSubmit:m,dataSource:s,actionColumn:{title:"\u64CD\u4F5C",dataIndex:"action",slots:{customRender:"action"},fixed:void 0}});function x(e){u("/agentwork/"+e.id)}function m({record:e,index:t,key:n,value:k}){b({action:"agentnote",data:{id:e.id,data:k}})}function T(e){let t=e.id?e.id:"all";b({action:"agentdel",data:{id:t}}).then(n=>{a.agents=n,o.success(`\u5220\u9664\u6210\u529F\u3002 ${t}`)}).catch(()=>{})}return P(()=>{if(r.value)try{r.value.arrayBuffer().then(e=>new Uint8Array(e)).then(e=>{let t=V.AgentEvent.decode(e);t.list&&t.list.agents.forEach(function(n){a.agents[n.id]=n,t.list.status=="create"&&o.info(`\u60A8\u6709\u65B0\u7684NPC\u4E0A\u7EBF:${n.hostname}\\${n.username}@${n.intranet}`)})})}catch(e){}}),S(()=>{M({action:"agentget"}).then(e=>{e.forEach(function(t){a.agents[t.id]=t})})}),W(()=>{}),{state:a,registerTableagents:i,getAgents:s,SetNpcNote:m,handleAgentWork:x,handleAgentDel:T}}});function K(a,s,c,d,r,A){const p=l("TableAction"),u=l("BasicTable"),o=l("PageWrapper");return j(),U(o,{dense:"",contentFullHeight:"",contentBackground:"",fixedHeight:""},{default:g(()=>[h(u,{onRegister:a.registerTableagents},{action:g(({record:i})=>[h(p,{actions:[{icon:"bi:eye",label:"\u8FDE\u63A5",onClick:a.handleAgentWork.bind(null,i)},{icon:"fluent:delete-24-filled",color:"error",label:"\u5220\u9664",onClick:a.handleAgentDel.bind(null,i)}]},null,8,["actions"])]),_:1},8,["onRegister"])]),_:1})}var _e=C(J,[["render",K]]);export{_e as default};
