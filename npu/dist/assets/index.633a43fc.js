var R=Math.pow;import{I as N,B as V,u as J}from"./useTable.64ef5827.js";import{T as K}from"./useForm.77c27927.js";import{b as y,aL as q,x as Q,c as b,c$ as H,f as P,r as A,aa as Z,k as i,a as w,c7 as ee,m as te,cf as ne,ch as ie,ek as ae,el as oe,aQ as le,s as se,aR as O,o as re,z as ce,j as ue,l as de,cj as E,q as me,ck as fe}from"./index.ecaec58b.js";import{a as ge}from"./index.e472a703.js";import{d as pe}from"./download.0a6ebd5a.js";import"./index.7c437fb2.js";import"./index.81d2e3e6.js";import"./index.9c3be20b.js";import"./useSize.37dbc3ba.js";import"./useContentViewHeight.33e9d1e7.js";import"./ArrowLeftOutlined.68372d7a.js";import"./index.d2065cf3.js";import"./FullscreenOutlined.fdf277a8.js";import"./_baseIteratee.95e39a32.js";import"./index.84bf6fd3.js";import"./index.c74c0e50.js";import"./isEqual.07d69833.js";import"./index.42eff1d5.js";import"./useSortable.d7a4a5d8.js";import"./index.5adf4b72.js";import"./index.66a07c9f.js";import"./scrollTo.3f609abf.js";import"./index.09531035.js";y({name:"ImagePreview",components:{Image:N,PreviewGroup:N.PreviewGroup},props:{functional:q.bool,imageList:{type:Array}},setup(n){const{prefixCls:u}=Q("image-preview"),d=b(()=>{const{imageList:r}=n;return r?r.map(t=>H(t)?{src:t,placeholder:!1}:t):[]});return{prefixCls:u,getImageList:d}}});var ve="./assets/resume.8f27866b.svg",he="./assets/p-rotate.cb8bbfc3.svg",we="./assets/scale.44abde22.svg",_e="./assets/unscale.c552f416.svg",xe="./assets/unrotate.ef6a2daf.svg",_=function(n){return n[n.LOADING=0]="LOADING",n[n.DONE=1]="DONE",n[n.FAIL=2]="FAIL",n}(_||{});const Ie={show:{type:Boolean,default:!1},imageList:{type:[Array],default:null},index:{type:Number,default:0},scaleStep:{type:Number},defaultWidth:{type:Number},maskClosable:{type:Boolean},rememberState:{type:Boolean}},l="img-preview";var be=y({name:"ImagePreview",props:Ie,emits:["img-load","img-error"],setup(n,{expose:u,emit:d}){const r=new Map,t=P({currentUrl:"",imgScale:1,imgRotate:0,imgTop:0,imgLeft:0,status:_.LOADING,currentIndex:0,moveX:0,moveY:0,show:n.show}),x=A(null),p=A(null);function v(){L();const{index:e,imageList:a}=n;if(!a||!a.length)throw new Error("imageList is undefined");t.currentIndex=e,D(a[e])}function m(){t.imgScale=1,t.imgRotate=0,t.imgTop=0,t.imgLeft=0}function L(){const e=w(x);!e||(e.onmousewheel=o,document.body.addEventListener("DOMMouseScroll",o),document.ondragstart=function(){return!1})}const h=b(()=>{var a;const e=(a=n==null?void 0:n.scaleStep)!=null?a:0;return(e!=null?e:0>0)?e/100:t.imgScale/10});function o(e){e=e||window.event,e.delta=e.wheelDelta||-e.detail,e.preventDefault(),e.delta>0&&s(h.value),e.delta<0&&s(-h.value)}function s(e){t.imgScale<=.2&&e<0||(t.imgScale+=e)}function g(e){t.imgRotate+=e}function C(){const e=w(p);!e||(e.onmousemove=null)}function D(e){t.status=_.LOADING;const a=new Image;a.src=e,a.onload=c=>{if(t.currentUrl!==e){const f=c.composedPath();if(n.rememberState){r.set(t.currentUrl,{scale:t.imgScale,top:t.imgTop,left:t.imgLeft,rotate:t.imgRotate});const I=r.get(e);I?(t.imgScale=I.scale,t.imgTop=I.top,t.imgRotate=I.rotate,t.imgLeft=I.left):(m(),n.defaultWidth&&(t.imgScale=n.defaultWidth/f[0].naturalWidth))}else n.defaultWidth&&(t.imgScale=n.defaultWidth/f[0].naturalWidth);f&&d("img-load",{index:t.currentIndex,dom:f[0],url:e})}t.currentUrl=e,t.status=_.DONE},a.onerror=c=>{const f=c.composedPath();f&&d("img-error",{index:t.currentIndex,dom:f[0],url:e}),t.status=_.FAIL}}function F(e){e&&e.stopPropagation(),M()}function M(){t.show=!1,document.body.removeEventListener("DOMMouseScroll",o),document.ondragstart=null}function T(){m()}u({resume:T,close:M,prev:S.bind(null,"left"),next:S.bind(null,"right"),setScale:e=>{e>0&&e<=10&&(t.imgScale=e)},setRotate:e=>{t.imgRotate=e}});function S(e){const{currentIndex:a}=t,{imageList:c}=n;e==="left"&&(t.currentIndex--,a<=0&&(t.currentIndex=c.length-1)),e==="right"&&(t.currentIndex++,a>=c.length-1&&(t.currentIndex=0)),D(c[t.currentIndex])}function G(e){e=e||window.event,t.moveX=e.clientX,t.moveY=e.clientY;const a=w(p);a&&(a.onmousemove=W)}function W(e){e=e||window.event,e.preventDefault();const a=e.clientX-t.moveX,c=e.clientY-t.moveY;t.imgLeft+=a,t.imgTop+=c,t.moveX=e.clientX,t.moveY=e.clientY}const z=b(()=>{const{imgScale:e,imgRotate:a,imgTop:c,imgLeft:f}=t;return{transform:`scale(${e}) rotate(${a}deg)`,marginTop:`${c}px`,marginLeft:`${f}px`,maxWidth:n.defaultWidth?"unset":"100%"}}),k=b(()=>{const{imageList:e}=n;return e.length>1});Z(()=>{n.show&&v(),n.imageList&&m()});const U=e=>{n.maskClosable&&e.target&&e.target.classList.contains(`${l}-content`)&&F(e)},X=()=>i("div",{class:`${l}__close`,onClick:F},[i(ee,{class:`${l}__close-icon`},null)]),Y=()=>{if(!w(k))return null;const{currentIndex:e}=t,{imageList:a}=n;return i("div",{class:`${l}__index`},[e+1,te(" / "),a.length])},j=()=>i("div",{class:`${l}__controller`},[i("div",{class:`${l}__controller-item`,onClick:()=>s(-h.value)},[i("img",{src:_e},null)]),i("div",{class:`${l}__controller-item`,onClick:()=>s(h.value)},[i("img",{src:we},null)]),i("div",{class:`${l}__controller-item`,onClick:T},[i("img",{src:ve},null)]),i("div",{class:`${l}__controller-item`,onClick:()=>g(-90)},[i("img",{src:xe},null)]),i("div",{class:`${l}__controller-item`,onClick:()=>g(90)},[i("img",{src:he},null)])]),B=e=>w(k)?i("div",{class:[`${l}__arrow`,e],onClick:()=>S(e)},[e==="left"?i(ne,null,null):i(ie,null,null)]):null;return()=>t.show&&i("div",{class:l,ref:x,onMouseup:C,onClick:U},[i("div",{class:`${l}-content`},[i("img",{style:w(z),class:[`${l}-image`,t.status===_.DONE?"":"hidden"],ref:p,src:t.currentUrl,onMousedown:G},null),X(),Y(),j(),B("left"),B("right")])])}});let $=null;function Le(n){var r;if(!ae)return;const u={},d=document.createElement("div");return Object.assign(u,{show:!0,index:0,scaleStep:100},n),$=i(be,u),oe($,d),document.body.appendChild(d),(r=$.component)==null?void 0:r.exposed}const Ce=y({name:"RoleManagement",components:{BasicTable:V,TableAction:K},setup(){const n=P({imgList:[]}),{apiUrl:u="/manjusaka"}=se(),{createMessage:d}=me(),[r,{openModal:t}]=ge(),[x,{reload:p}]=J({title:"NPC\u4E0A\u4F20\u6587\u4EF6",columns:[{title:"NPC",dataIndex:"agent",width:300},{title:"\u8DEF\u5F84",dataIndex:"filepath",align:"right"},{title:"\u540D\u79F0",dataIndex:"filename",align:"left"},{title:"\u5927\u5C0F",dataIndex:"filesize",width:80,customRender:({record:o})=>v(o.filesize)},{title:"\u65F6\u95F4",dataIndex:"updateat",width:100,customRender:({record:o})=>fe(new Date(o.updateat*1e3))}],showTableSetting:!0,bordered:!0,showIndexColumn:!1,size:"small",clickToRowSelect:!1,actionColumn:{title:"\u64CD\u4F5C",dataIndex:"action",width:220,slots:{customRender:"action"},fixed:void 0},api:E,pagination:{pageSizeOptions:[100,200,500,1e3],pageSize:100},beforeFetch:function(o){const{page:s,pageSize:g}=o;return{action:"filelist",data:{page:s,size:g}}}}),v=o=>{const s=["Bytes","KB","MB","GB","TB"];if(o==0)return"-";const g=Math.floor(Math.log(o)/Math.log(1024)),C=(o/R(1024,g)).toFixed(0);return g===0?"1 KB":`${C} ${s[g]}`};function m(o){E({action:"filedelete",data:{id:o.id}}).then(()=>{d.success("\u5220\u9664\u6210\u529F")}).catch(()=>{}).finally(()=>{p()})}function L(o){pe({url:u+"/filedownload?id="+o.id,fileName:o.fileanme})}function h(o){let s=u+"/filedownload?id="+o.id;n.imgList.indexOf(s)==-1&&n.imgList.push(s),Le({imageList:n.imgList,defaultWidth:800,scaleStep:5,index:n.imgList.indexOf(s)})}return{registerTablefileret:x,registerModal:r,bytesToSize:v,handleDelete:m,handleDownload:L,handleImageView:h}}}),Se={style:{display:"flex","justify-content":"space-between","align-items":"center"}};function $e(n,u,d,r,t,x){const p=O("TableAction"),v=O("BasicTable");return re(),ce("div",null,[i(v,{onRegister:n.registerTablefileret},{action:ue(({record:m})=>[de("div",Se,[i(p,{actions:[{icon:"fa-solid:cloud-download-alt",label:"\u4E0B\u8F7D",onClick:n.handleDownload.bind(null,m)},{icon:"ant-design:delete-outlined",color:"error",label:"\u5220\u9664",popConfirm:{title:"\u786E\u8BA4\u5220\u9664\uFF1F",confirm:n.handleDelete.bind(null,m)}},{icon:"bi:eye",label:"\u9884\u89C8",auth:!/\.(PNG|JPG|JPEG|GIF|BMP)$/i.test(m.filename),onClick:n.handleImageView.bind(null,m)}]},null,8,["actions"])])]),_:1},8,["onRegister"])])}var Qe=le(Ce,[["render",$e]]);export{Qe as default};
