var V=Object.defineProperty,G=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var P=(e,o,n)=>o in e?V(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,M=(e,o)=>{for(var n in o||(o={}))U.call(o,n)&&P(e,n,o[n]);if(v)for(var n of v(o))q.call(o,n)&&P(e,n,o[n]);return e},_=(e,o)=>G(e,O(o));var B=(e,o,n)=>new Promise((c,p)=>{var m=r=>{try{l(n.next(r))}catch(d){p(d)}},i=r=>{try{l(n.throw(r))}catch(d){p(d)}},l=r=>r.done?c(r.value):Promise.resolve(r.value).then(m,i);l((n=n.apply(e,o)).next())});import{b as C,f as w,r as z,c as L,a as S,aQ as k,q as $,cj as F,aR as h,o as R,i as W,j as D,k as g,aT as y,s as H,z as j,m as E,e as Q,bM as A,ck as J}from"./index.ecaec58b.js";import{S as T}from"./index.84bf6fd3.js";import{B as K,u as X}from"./useTable.64ef5827.js";import{B as I,u as x,A as Y,T as Z}from"./useForm.77c27927.js";import{D as ee}from"./index.292bc1f2.js";import{B as te,u as oe,a as ne}from"./index.4cf09d76.js";import{B as ae,u as re,a as ue}from"./index.e472a703.js";import"./index.7c437fb2.js";import"./index.81d2e3e6.js";import"./index.9c3be20b.js";import"./useSize.37dbc3ba.js";import"./useContentViewHeight.33e9d1e7.js";import"./ArrowLeftOutlined.68372d7a.js";import"./index.d2065cf3.js";import"./FullscreenOutlined.fdf277a8.js";import"./_baseIteratee.95e39a32.js";import"./index.c74c0e50.js";import"./isEqual.07d69833.js";import"./index.42eff1d5.js";import"./useSortable.d7a4a5d8.js";import"./index.5adf4b72.js";import"./index.66a07c9f.js";import"./scrollTo.3f609abf.js";import"./index.09531035.js";import"./download.0a6ebd5a.js";import"./index.e03c8569.js";const le=C({name:"RoleDrawer",components:{BasicDrawer:te,BasicForm:I},emits:["success","register"],setup(e,{emit:o}){const n=w({listens:[]}),c=z(!0),p=[{field:"id",label:"\u9879\u76EEID",component:"Input",componentProps:{disabled:!0}},{field:"transport",label:"\u534F\u8BAE",required:!0,component:"RadioButtonGroup",componentProps:{options:[{label:"HTTP(s)",value:"http"},{label:"OSS",value:"oss"},{label:"DNS",value:"dns"}]}},{field:"name",label:"\u9879\u76EE\u540D\u79F0",required:!0,component:"Input"},{field:"callback1",label:"\u56DE\u8C03\u5730\u5740",required:!0,component:"Input",componentProps:{placeholder:"http://192.168.93.1:31000"}},{field:"listen",label:"\u8FDE\u63A5\u5730\u5740",component:"ApiSelect",componentProps:{api:F,params:{action:"listenlist"},labelField:"onlineaddr",valueField:"id",resultField:"items"}},{field:"domain",label:"\u4E0A\u7EBF\u57DF\u540D",component:"Input",componentProps:{placeholder:"\u57DF\u524D\u7F6E"}},{field:"proxy",label:"\u4EE3\u7406\u5730\u5740",component:"Input",componentProps:{placeholder:"(socks|http|https)://user:pass@127.0.0.1:8080"}},{field:"route",label:"\u8DEF\u7531",component:"Input",componentProps:{}},{field:"enckey",label:"\u5BC6\u94A5",component:"Input",componentProps:{}},{field:"config",label:"\u5176\u5B83\u914D\u7F6E",component:"InputTextArea",componentProps:{autoSize:!0}},{field:"note",label:"\u5907\u6CE8",component:"Input"}],[m,{resetFields:i,setFieldsValue:l,validate:r}]=x({labelWidth:100,schemas:p,showActionButtonGroup:!1}),[d,{setDrawerProps:f,closeDrawer:b}]=oe(t=>B(this,null,function*(){i(),f({confirmLoading:!1}),c.value=!!(t!=null&&t.isUpdate),S(c)?l(_(M({},t.record),{transport:t.record.transport||"http"})):l({transport:"http"})})),a=L(()=>S(c)?"\u7F16\u8F91\u9879\u76EE":"\u65B0\u589E\u9879\u76EE");function u(){return B(this,null,function*(){try{const t=yield r(),{createMessage:s}=$();f({confirmLoading:!0}),F({action:"projectupdate",data:t}).then(()=>{s.success("\u6210\u529F! \u8BF7\u5237\u65B0\u5217\u8868")}).catch(()=>{}).finally(()=>{o("success")}),b()}finally{f({confirmLoading:!1})}})}return{state:n,registerDrawer:d,registerForm:m,getTitle:a,handleSubmit:u}}});function se(e,o,n,c,p,m){const i=h("BasicForm"),l=h("BasicDrawer");return R(),W(l,y(e.$attrs,{onRegister:e.registerDrawer,showFooter:"",title:e.getTitle,width:"600px",onOk:e.handleSubmit}),{default:D(()=>[g(i,{onRegister:e.registerForm},null,8,["onRegister"])]),_:1},16,["onRegister","title","onOk"])}var ie=k(le,[["render",se]]);H();const ce=C({name:"RoleModal",components:{BasicModal:ae,BasicForm:I,Alert:Y},emits:["success","register"],setup(){const e=w({mod:[1,1,1,1],url:""}),[o,{resetFields:n,setFieldsValue:c,getFieldsValue:p}]=x({labelWidth:120,schemas:[{field:"name",component:"Input",label:"\u9879\u76EE\u540D\u79F0",componentProps:{disabled:!0}},{field:"callback1",component:"Input",label:"\u56DE\u8FDE\u5730\u5740",componentProps:{disabled:!0}},{field:"route",component:"Input",label:"\u9879\u76EE\u8DEF\u7531",componentProps:{disabled:!0}},{field:"arch",label:"arch",component:"RadioButtonGroup",defaultValue:"x86_64",componentProps:a=>({options:[{label:"x86_64",value:"1"},{label:"x86",value:"2"},{label:"aarch64",value:"3"},{label:"arm",value:"4"},{label:"mips64",value:"5"},{label:"mips",value:"6"},{label:"loongarch64",value:"7"}],onChange:u=>{e.mod[2]=u,r()}})},{field:"platform",label:"NPC\u7C7B\u578B",component:"RadioButtonGroup",defaultValue:"exe",componentProps:a=>({options:[{label:"windows",value:"1"},{label:"linux",value:"2"},{label:"macos",value:"3"}],onChange:u=>{e.mod[3]=u,r()}})}],showResetButton:!1,showSubmitButton:!1}),[m,{setModalProps:i,closeModal:l}]=re(a=>B(this,null,function*(){if(c(a),a.callback1&&a.route){let u=parseInt(e.mod.join(""));e.url=a.callback1.trim().replace(/\/+$/,"")+"/"+a.route+"/"+f(u)+".png"}}));function r(){let a=p();if(a.callback1&&a.route){let u=parseInt(e.mod.join(""));e.url=a.callback1.trim().replace(/\/+$/,"")+"/"+a.route+"/"+f(u)+".png"}}function d(){window.open(e.url)}function f(a){if(a>9999)return a.toString();for(;;){const u=b(6);let t=BigInt(1);for(let s of u)t=t*BigInt(s.charCodeAt(0))%BigInt(1e4);if(t===BigInt(a))return u}}function b(a){const u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let s=0;s<a;s++)t+=u.charAt(Math.floor(Math.random()*u.length));return t}return{state:e,registerModal:m,registerForm:o,handleSubmit:d}}});function pe(e,o,n,c,p,m){const i=h("BasicForm"),l=h("Alert"),r=h("BasicModal");return R(),j("div",null,[g(r,y(e.$attrs,{width:800,title:"\u751F\u6210NPC1",okText:"\u4E0B\u8F7D",onRegister:e.registerModal,onOk:e.handleSubmit}),{default:D(()=>[g(i,{onRegister:e.registerForm},null,8,["onRegister"]),o[0]||(o[0]=E(" NPC\u4E0B\u8F7D\u5730\u5740 ",-1)),g(l,{message:e.state.url},null,8,["message"])]),_:1},16,["onRegister","onOk"])])}var de=k(ce,[["render",pe]]);const me=C({name:"ProjectManagement",components:{BasicTable:K,RoleDrawer:ie,TableAction:Z,Description:ee,BasicForm:I,RoleModal:de},setup(){const e=w({target:{}}),{createMessage:o}=$(),n=Q(),[c,{openDrawer:p}]=ne(),[m,{openModal:i}]=ue(),[l,{reload:r}]=X({title:"NPC1\u76D1\u542C\u5668",columns:[{title:"\u9879\u76EE\u540D\u79F0",dataIndex:"name"},{title:"\u56DE\u8C03\u5730\u5740",dataIndex:"callback1"},{title:"\u8DEF\u7531",dataIndex:"route"},{title:"\u5BC6\u94A5",dataIndex:"enckey"},{title:"\u5F53\u524D",width:100,customRender:({record:t})=>A(T,{checked:t.id==n.getTarget&&(e.target=t)!=!1,checkedChildren:"\u5F53\u524D",unCheckedChildren:"\u9009\u62E9",onChange(s){F({action:"projectself",data:{id:t.id}}).then(()=>{n.setTarget(t.id),e.target=t,o.success(`\u5F53\u524D\u9879\u76EE: ${t.name}`)}).catch(()=>{}).finally(()=>{})}})},{title:"\u72B6\u6001",dataIndex:"isrun",width:100,customRender:({record:t})=>A(T,{checked:t.isrun==!0,checkedChildren:"\u5DF2\u542F\u7528",unCheckedChildren:"\u5DF2\u7981\u7528",onChange(s){t.isrun=s,F({action:"projectupdate",data:t}).then(()=>{t.isrun=s,o.success("\u5DF2\u6210\u529F\u4FEE\u6539\u9879\u76EE\u72B6\u6001")}).catch(()=>{}).finally(()=>{})}})},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"updateat",customRender:({record:t})=>J(new Date(t.updateat*1e3))}],api:F,showTableSetting:!0,bordered:!0,showIndexColumn:!1,actionColumn:{title:"\u64CD\u4F5C",dataIndex:"action",slots:{customRender:"action"},fixed:void 0},beforeFetch:function(t){const{page:s,pageSize:N}=t;return{action:"projectlist",data:{page:s,size:N}}}});function d(){p(!0,{isUpdate:!1}),r()}function f(t){p(!0,{record:t,isUpdate:!0}),r()}function b(t){F({action:"projectdelete",data:{id:t.id}}).then(()=>{o.success("\u5220\u9664\u6210\u529F")}).catch(()=>{}).finally(()=>{r()})}function a(){r()}function u(t){let s={name:e.target.name,callback1:e.target.callback1,route:e.target.route,platform:"1",arch:"1"};i(!0,s)}return{registerTableproj:l,registerDrawer:c,registerModal:m,handleCreate:d,handleEdit:f,handleDelete:b,handleSuccess:a,handleAgentCreate:u}}});function fe(e,o,n,c,p,m){const i=h("a-button"),l=h("TableAction"),r=h("BasicTable"),d=h("RoleDrawer"),f=h("RoleModal");return R(),j("div",null,[g(r,{onRegister:e.registerTableproj},{toolbar:D(()=>[g(i,{type:"primary",onClick:e.handleAgentCreate},{default:D(()=>[...o[0]||(o[0]=[E(" \u751F\u6210NPC1 ",-1)])]),_:1},8,["onClick"]),g(i,{type:"primary",onClick:e.handleCreate},{default:D(()=>[...o[1]||(o[1]=[E(" \u65B0\u5EFA\u9879\u76EE ",-1)])]),_:1},8,["onClick"])]),action:D(({record:b})=>[g(l,{actions:[{icon:"clarity:note-edit-line",label:"\u7F16\u8F91",onClick:e.handleEdit.bind(null,b)},{icon:"ant-design:delete-outlined",label:"\u5220\u9664",color:"error",popConfirm:{title:"\u662F\u5426\u786E\u8BA4\u5220\u9664",confirm:e.handleDelete.bind(null,b)}}]},null,8,["actions"])]),_:1},8,["onRegister"]),g(d,{onRegister:e.registerDrawer,onSuccess:e.handleSuccess},null,8,["onRegister","onSuccess"]),g(f,{onRegister:e.registerModal},null,8,["onRegister"])])}var Ue=k(me,[["render",fe]]);export{Ue as default};
